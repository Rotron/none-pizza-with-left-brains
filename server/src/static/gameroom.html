<!DOCTYPE html>
<html>

<head>
    <style>
        body {
            font-family: Tahoma, Geneva, sans-serif;
            text-align: center;
        }
    </style>

    <!-- dummy Symbol polyfill -->
    <script>if (typeof (Symbol) === "undefined") { window.Symbol = function (arg) { return arg; } }</script>

    <!-- colyseus.js client (npm run bundle-colyseus-client) -->
    <script type="text/javascript" src="colyseus.js"></script>

    <style type="text/css">
        .hero {
            width: 100px;
            height: 100px;
            position: absolute;
            padding-top: 24px;
            box-sizing: border-box;
            left: 0;
            top: 0;
        }
    </style>

</head>

<body>
    <h1>
        <a href="https://github.com/gamestdio/colyseus-examples">
            <img src="https://rawgit.com/gamestdio/colyseus/master/media/header.png" height="100" alt="colyseus" />
        </a>
    </h1>

    <script>
        var host = window.document.location.host.replace(/:.*/, '');

        var client = new Colyseus.Client(location.protocol.replace("http", "ws") + host + (location.port ? ':' + location.port : ''));
        var room = client.join("GameRoom");

        var heroes = {};
        var colors = ['red', 'green', 'yellow', 'blue', 'cyan', 'magenta'];

        document.addEventListener('keydown', function(event) {
            if(event.keyCode == 37) { // Left arrow key
                send({x: -1});
            }
            else if(event.keyCode == 38) { // Up arrow key
                send({y: -1});
            }
            else if(event.keyCode == 39) { // Right arrow key
                send({x: 1});
            }
            else if(event.keyCode == 40) { // Down arrow key
                send({y: 1});
            }
        });

        // listen to patches coming from the server
        room.listen("heroes/:id", function (change) {
            if (change.operation === "add") {
                var dom = document.createElement("div");
                dom.className = "hero";
                dom.style.left = change.value.x + "px";
                dom.style.top = change.value.y + "px";
                dom.style.background = colors[Math.floor(Math.random() * colors.length)];
                dom.innerHTML = `Hero '${change.path.id}'`;

                heroes[change.path.id] = dom;
                document.body.appendChild(dom);

            } else if (change.operation === "remove") {
                document.body.removeChild(heroes[change.path.id]);
                delete heroes[change.path.id];
            }
        });

        room.listen("heroes/:id/:axis", function (change) {
            var dom = heroes[change.path.id];

            var styleAttribute = (change.path.axis === "x")
                ? "left"
                : "top";

            dom.style[styleAttribute] = change.value + "px";
        });

        function send(data) {
            room.send(data);    
        }

    </script>
</body>

</html>